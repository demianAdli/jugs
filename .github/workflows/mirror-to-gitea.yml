name: Mirror to Gitea (full)

on:
  push:
    branches: ["**"]
    tags: ["**"]

concurrency:
  group: mirror-to-gitea
  cancel-in-progress: false

jobs:
  mirror:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout full history
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up git identity
        run: |
          git config user.name "github-actions"
          git config user.email "actions@users.noreply.github.com"

      - name: Push all branches and tags to Gitea (no deletes)
        env:
          GITEA_TOKEN: ${{ secrets.GITEA_TOKEN }}
        run: |
          set -euo pipefail

          # Your real remote
          git remote add gitea https://a_adli:${GITEA_TOKEN}@ngci.encs.concordia.ca/gitea/a_adli/jugs.git

          # Push all branches and tags, but DO NOT delete remote-only refs (no --mirror)
          git push gitea --all
          git push gitea --tags
