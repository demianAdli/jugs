name: Mirror to Gitea (full)

on:
  push:
    branches: ["**"]
    tags: ["**"]

jobs:
  mirror:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout full history
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up git identity
        run: |
          git config user.name "github-actions"
          git config user.email "actions@users.noreply.github.com"

      - name: Add Gitea remote and push --mirror
        env:
          GITEA_TOKEN: ${{ secrets.GITEA_TOKEN }}
        run: |
          # CHANGE THESE THREE: GITEA_HOST, OWNER, REPO
          # Example:
          # GITEA_HOST=ngci.encs.concordia.ca/gitea
          # OWNER=a_adli
          # REPO=jugs
          GITEA_HOST="YOUR.GITEA.HOST/PATH"
          OWNER="YOUR_GITEA_USERNAME_OR_ORG"
          REPO="DEST_REPO_NAME"

          git remote add gitea https://a_adli:${GITEA_TOKEN}@ngci.encs.concordia.ca/gitea/a_adli/jugs.git
          git push --mirror gitea

      - name: Push LFS objects (if you use Git LFS)
        if: ${{ always() }}
        run: |
          if command -v git-lfs >/dev/null 2>&1; then
            git lfs fetch --all
            git lfs push --all gitea || true
          fi
